#include "mGameRoulette.h"
#include "server/mServer.h"
#include "server/mUser.h"

static TRouletteProducer Roulette;

char* TRouletteRoom::fBetCode[sCount] = {
	"s0",
	"s1",
	"s2",
	"s3",
	"s4",
	"s5",
	"s6",
	"s7",
	"s8",
	"s9",
	"s10",
	"s11",
	"s12",
	"s13",
	"s14",
	"s15",
	"s16",
	"s17", 
	"s18", 
	"s19", 
	"s20",
	"s21",
	"s22", 
	"s23",
	"s24",
	"s25", 
	"s26",
	"s27",
	"s28",
	"s29",
	"s30",
	"s31",
	"s32",  
	"s33",  
	"s34",  
	"s35",
	"s36",  

	"p1",   
	"p2",   
	"p3",   
	"p4",   
	"p5",   
	"p6",
	"p7",
	"p8",
	"p9",
	"p10",
	"p11",
	"p12",
	"p13",
	"p14",
	"p15",
	"p16",
	"p17",
	"p18",
	"p19",
	"p20",
	"p21",
	"p22",
	"p23",
	"p24",
	"p25",
	"p26",
	"p27",
	"p28",  
	"p29",  
	"p30",  
	"p31",  
	"p32",  
	"p33",  
	"p34",  
	"p35",  
	"p36",  
	"p37",  
	"p38",  
	"p39",  
	"p40",  
	"p41",  
	"p42",  
	"p43",  
	"p44",  
	"p45",  
	"p46",  
	"p47",  
	"p48",  
	"p49",  
	"p50",  
	"p51",  
	"p52",  
	"p53",  
	"p54",  
	"p55",  
	"p56",  
	"p57",  
	"p58",  
	"p59",  
	"p60",  

	"t1",
	"t2",
	"t3",
	"t4",
	"t5",
	"t6",
	"t7",
	"t8",
	"t9",
	"t10",
	"t11",
	"t12",
	"t13",
	"t14",

	"n0",
	"n1",
	"n2",
	"n3",
	"n4",
	"n5",
	"n6",
	"n7",
	"n8",
	"n9",
	"n10",
	"n11",
	"n12",
	"n13",
	"n14",
	"n15",
	"n16",
	"n17",
	"n18",
	"n19",
	"n20",
	"n21",
	"n22",
        
	"x1",
	"x2",
	"x3",
	"x4",
	"x5",
	"x6",
	"x7",
	"x8",
	"x9",
	"x10",
	"x11",

	"d1",
	"d2",
	"d3",

	"c1",
	"c2",
	"c3",

	"e",
	"o",
	"k",
	"r",
	"m",
	"b"
};

unsigned int  TRouletteRoom::fBetCashWin[sCount][37] = {
	{ 36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  36 },

	{ 18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{ 18,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{ 18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,   0,   0,  18 },
	{  0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  18,  18 },
                                                                                                                                                                                             
	{ 12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{ 12,   0,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  12,  12,  12 },

	{  9,   9,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   9,   9,   0,   9,   9 },

	{  0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   6,   6,   6,   6,   6 },

	{  0,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3,   3 },

	{  0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0 },
	{  0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0 },
	{  0,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3,   0,   0,   3 },

	{  0,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2 },
	{  0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0 },
	{  0,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   2,   0,   2,   0,   2,   0,   2,   0,   0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   2,   0,   2,   0,   2,   0,   2,   0 },
	{  0,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   0,   2,   0,   2,   0,   2,   0,   2,   2,   0,   2,   0,   2,   0,   2,   0,   2,   0,   0,   2,   0,   2,   0,   2,   0,   2 },
	{  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2 },
	{  0,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   2,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 }
};

char          TRouletteRoom::fBetCashCode[8][3];
int           TRouletteRoom::fBetCashMax[8][3];
int           TRouletteRoom::fBetCashMin[8][3];

bool R_Color(unsigned int ID)
{
	if(
		ID == 1 ||
		ID == 3 ||
		ID == 5 ||
		ID == 7 ||
		ID == 9 ||
		ID == 12 ||
		ID == 14 ||
		ID == 16 ||
		ID == 18 ||
		ID == 19 ||
		ID == 21 ||
		ID == 23 ||
		ID == 25 ||
		ID == 27 ||
		ID == 30 ||
		ID == 32 ||
		ID == 34 ||
		ID == 36
	)
		return true;
	return false;
}

static const unsigned int rndSize = 1024*10;
static unsigned int rndNumber[rndSize];
static unsigned int rndCount = rndSize;

unsigned int getRndNumber()
{
	if( rndCount >= rndSize ) {
		for( rndCount = 0; rndCount < rndSize; rndCount++ )
			rndNumber[rndCount] = getRnd(37);
		rndCount = 0;
	}
	return rndNumber[rndCount++];
}

unsigned int R_getRnd(
		unsigned int* fHistory,
		unsigned int i)
{
	unsigned int Num;
	unsigned int iCount;
	do {
		Num = getRndNumber();
		iCount = 0;
		for( unsigned int j = 0; j < i; j++ )
			if( fHistory[j] == Num )
				iCount++;
		if( i >= 2 && fHistory[i-1] == Num && fHistory[i-2] == Num )
			iCount = 10;
	} while( iCount > 3 );
	return Num;
/*
	unsigned int ID;
	int iCount;
	do {
		ID = getRndNumber();
		iCount = 0;
		for( unsigned int j = 0; j < i; j++ )
		{
			if( fHistory[j] == ID )
				iCount++;
		}
		if( i >= 2 && fHistory[i-1] == ID && fHistory[i-2] == ID )
			iCount = 10;
		bool fColor[14];
		for( unsigned int j = 0; j < i; j++ ) {
			fColor[j] = R_Color(fHistory[j]);
//      if( fColor[j] )
//        printf( "%d 1 ",fHistory[j]);
//			else
//        printf( "%d 0 ",fHistory[j]);
		}
//    printf("\n");
		if(
			i > 4 &&
			(R_Color(ID) == fColor[i-1]) &&
			(fColor[i-1] == fColor[i-2]) &&
			(fColor[i-2] == fColor[i-3]) &&
			(fColor[i-3] == fColor[i-4])
		) {
			iCount = 10;
//      print("iCount=10\n");
		}
	} while( iCount >= 3 );
	return ID;
*/
}



// TRouletteRoom


TRouletteRoom::TRouletteRoom(const unsigned int Count)
: IPlayerRoom(Count),fBetList(200,true)
{
	for( unsigned int i = 0; i < cHistory; i++ )
	{
		GameNext();
		fHistory[i] = R_getRnd(fHistory,i);
	}
}


int TRouletteRoom::FindBetIndex(const TStr& Code, IPlayer *p)
{
	for( unsigned int j = 0; j < fBetList.Count(); j++ )
		if( Code == fBetList.Get(j)->Code() && fBetList.Get(j)->Player() == p )
			return j;
	return -1;
}

void TRouletteRoom::OnBet(TRequest *r, IPlayer* Player)
{
//  bool isGame = Player->fGameNum == fGameNum;
	TServerSSI rs;
	for( unsigned int i = 0; i < r->xml()->NodesCount(); i++ )
	{
		if( r->xml()->GetNode(i)->GetName() == "action" ) {
			Player->ActionUpdate(1);
		} else
		if( r->xml()->GetNode(i)->GetName() == "bet" ) {
			// Если пришел clear и уже текущая игра прошла, то ставки нельзя вернуть
			if( r->xml()->GetNode(i)->VarValue("action") == "clear" ) {
				unsigned int j = 0;
				rs.ssi()->SSIValue("USERID",Player->ID());
				while( j < fBetList.Count() )
				{
					if( fBetList.Get(j)->Player() == Player ) {
						rs.ssi()->SSIValue("ID",fBetList.Get(j)->Code());
						rs.ssi()->SSIValue("CASH",-fBetList.Get(j)->Cash());
						PlayerMessage(rs.ssi()->SSIRes("roulette_bet_user"),Player);
						Player->User()->CashBetAdd(Table(),-fBetList.Get(j)->Cash());
						fBetList.Del(j);
					} else
						j++;
				}
			} else {
				TStr Code(r->xml()->GetNode(i)->VarValue("id"));
				int  Cash = r->xml()->GetNode(i)->VarValue("cash").ToIntDef(0);
				if( Cash != 0  ) {
					rs.ssi()->SSIValue("ID",Code);
					if( !Player->isGame() ) {
						rs.ssi()->SSIValue("CASH",-Cash);
						Player->AddMsg(rs.ssi()->SSIRes("roulette_bet_return"));
					} else {
						rs.ssi()->SSIValue("CASH",Cash);
						bool fReturn = Player->User()->Status() == tGIFT && Cash > 1;
						int index = FindBetIndex(Code,Player);

						if( !fReturn )
							if( Cash > 0 ) {
								if( index > -1 )
									fReturn = !BetLimitCheck(Code[0],fBetList.Get(index)->Cash()+Cash);
								else
									fReturn = !BetLimitCheck(Code[0],Cash);
							}
						if( !fReturn ) {
							if( Cash < 0 ) {
								if( index > -1 ) {
									TBet* Bet = fBetList.Get(index);
									if( (Bet->Cash() + Cash) >= 0 ) {
										Player->User()->CashBetAdd(Table(),Cash);
										Bet->CashAdd(Cash);
										rs.ssi()->SSIValue("USERID",Player->ID());
										PlayerMessage(rs.ssi()->SSIRes("roulette_bet_user"),Player);
									}
								}
							} else
							if( Cash > 0 ) {
								fReturn = !Player->User()->CashBetAdd(Table(),Cash);
								if( !fReturn ) {
									if( index > -1 )
										fBetList.Get(index)->CashAdd(Cash);
									else
										fBetList.Append(new TBet(Player,Code,Cash));
									rs.ssi()->SSIValue("USERID",Player->ID());
									PlayerMessage(rs.ssi()->SSIRes("roulette_bet_user"),Player);
								}
							}
// ERROR
//							else
//								Player->User()->CashBetAdd(Table(),-Cash);
						}
						if( fReturn ) {
							rs.ssi()->SSIValue("CASH",-Cash);
							Player->AddMsg(rs.ssi()->SSIRes("roulette_bet_return"));
						}
					}
				}
			}
		}
	}
}


bool TRouletteRoom::BetLimitCheck(char Code, int Cash)
{
	if( Code == 'o' || Code == 'r' || Code == 'b' || Code == 'm' || Code == 'k' )
		Code = 'e';
	for( unsigned int k = 0; k < 8; k++ )
		if( fBetCashCode[k][Table()-1] == Code ) {
			if( fBetCashMax[k][Table()-1] < Cash || fBetCashMin[k][Table()-1] > Cash )
				break;
			return true;
		}
	return false;
}


void TRouletteRoom::BetLimitCheck()
{
	TServerSSI rs;
	for( unsigned int j = 0; j < fBetList.Count(); j++ )
	{
		TBet * bet = fBetList.Get(j);
		if( bet->Cash() != 0 && !BetLimitCheck(bet->Code()[0],fBetList.Get(j)->Cash()) )
		{
			rs.ssi()->SSIValue("ID",bet->Code());
			rs.ssi()->SSIValue("CASH",bet->Cash());
			rs.ssi()->SSIValue("USERID",bet->Player()->ID());
			bet->CashAdd(-bet->Cash());
			bet->Player()->User()->CashBetAdd(Table(),-bet->Cash());
			bet->Player()->AddMsg(rs.ssi()->SSIRes("roulette_bet_return"));
			PlayerMessage(rs.ssi()->SSIRes("roulette_bet_user"),bet->Player());
		}
	}
}


struct TGameResult
{
	IPlayer*         player;
	unsigned int     cashbet;
	unsigned int     cashwin;
	TStr             log;
	int              winID;
};


void TRouletteRoom::OnGame()
{
	unsigned int i;
	bool isGame = Player(0)->Action() != 0;
	for( i = 0; i < PlayerCount(); i++ )
		if( !Player(i)->Action() ) {
			isGame = false;
			break;
		}
//  if( !isGame && isTimer() != 0 )
	isGame = isGame || isTimer();

	if( !isGame )
		return;

	unsigned int             Number;
	TGameResult              GameResult[5];
	m_object::TVector<TBet>  WinList(200,false);

	BetLimitCheck();

	for( i = 0; i < PlayerCount(); i++ )
	{
		GameResult[i].player = Player(i);
		GameResult[i].winID = 0;
		Player(i)->User()->CashBetCommit(cRouletteGame,Table(),0);
	}

	bool f = false;
	unsigned int iCount = 0;
	do {
		WinList.Clear();
		Number = getRndNumber();
//		printf("%d\n",Number);
		for( i = 0; i < PlayerCount(); i++ )
		{
			Player(i)->User()->CashWinRollback();
			GameResult[i].cashbet = 0;
			GameResult[i].cashwin = 0;
		}
		for( i = 0; i < fBetList.Count(); i++ )
		{
			TBet *Bet = fBetList.Get(i);
			TGameResult *gm = NULL;
			unsigned int j;
			for( j = 0; j < PlayerCount(); j++ )
				if( Bet->Player() == GameResult[j].player ) {
					 gm = &GameResult[j];
					 break;
				}
			gm->cashbet += Bet->Cash();
			for( j = 0; j < sCount; j++ )
			{
				if( strcmp(Bet->Code(),fBetCode[j]) == 0 ) {
					if( fBetCashWin[j][Number] > 0 ) {
						Bet->fWin = Bet->Cash()*fBetCashWin[j][Number];
						if( Bet->fWin > 0 ) {
							gm->cashwin += Bet->fWin;
							WinList.Add(Bet);
						}
					}
					break;
				}
			}
		}
		f = false;
		for( i = 0; i < PlayerCount(); i++ ) {
			f = !Player(i)->User()->CashWinUpdate(
					cRouletteGame,Table(),
					GameResult[i].cashwin,
					iCount>=100);
			if( f )
				break;
		}
		iCount++;
		if( iCount > 100 )
			break;
	} while( f );

	for( i = cHistory-1; i > 0; i-- )
		fHistory[i] = fHistory[i-1];
	fHistory[0] = Number;


	TServerSSI rs;
	for( i = 0; i < WinList.Count(); i++ )
	{
		TBet *Bet = WinList.Get(i);
		rs.ssi()->SSIValue("CASH",Bet->fWin);
		rs.ssi()->SSIValue("ID",Bet->Code());
		rs.ssi()->SSIValue("USERID",Bet->Player()->ID());
		Bet->Player()->AddMsg(rs.ssi()->SSIRes("roulette_bet_win"));
		PlayerMessage(rs.ssi()->SSIRes("roulette_bet_win_user"),Bet->Player());
	}
	for( i = 0; i < fBetList.Count(); i++ )
	{
		TBet *Bet = fBetList.Get(i);
		TGameResult *gm = NULL;
		unsigned int j;
		for( j = 0; j < PlayerCount(); j++ )
			if( Bet->Player() == GameResult[j].player ) {
				 gm = &GameResult[j];
				 break;
			}
		if( Bet->Cash() > 0 )
			gm->log += TStr("<bet id=\"")+Bet->Code()+"\" cash=\""+Bet->Cash()+"\" />";
	}
	rs.ssi()->SSIValue("NUMBER",Number);
	for( i = 0; i < PlayerCount(); i++ )
	{
		IPlayer * p = Player(i);
		if( !GameResult[i].log.isEmpty() )
			GameResult[i].log += TStr("<game number=\"")+Number+"\" />";
		p->ActionUpdate(0);

	rs.ssi()->SSIValue("CASH",p->User()->Cash());
	rs.ssi()->SSIValue("BONUS",p->User()->CashBonus());
	p->AddMsg(rs.ssi()->SSIRes("server_user"));

		p->User()->CashWinCommit(GameResult[i].log);
		p->User()->CashCommit();
		p->AddMsg(p->User()->Message());

		rs.ssi()->SSIValue("CASHBET",GameResult[i].cashbet);
		rs.ssi()->SSIValue("CASHWIN",GameResult[i].cashwin);
		p->AddMsg(rs.ssi()->SSIRes("roulette_result"));
	}
	fBetList.Clear();
	TimerStop();
	GameNext();

/*
	for( unsigned int i = 0; i < PlayerCount(); i++ )
	{
		Player(i)->User()->ToSSI(rs.ssi());
		Player(i)->AddMsg(rs.ssi()->SSIRes("server_user"));
	}
*/
}


void TRouletteRoom::OnPlayerAdd(IPlayer *Player)
{
	TServerSSI rs;
	rs.ssi()->SSIValue("ID",Player->ID());
	rs.ssi()->SSIValue("Nick",Player->User()->Nick());
	rs.ssi()->SSIValue("ICON",Player->User()->Icon());
	PlayerMessage(rs.ssi()->SSIRes("roulette_user_join"),Player);
	{
		for( unsigned int i = 0; i < PlayerCount(); i++ )
		{
			rs.ssi()->SSIValue("ID",IPlayerRoom::Player(i)->ID());
			rs.ssi()->SSIValue("Nick",IPlayerRoom::Player(i)->User()->Nick());
			rs.ssi()->SSIValue("ICON",IPlayerRoom::Player(i)->User()->Icon());
			Player->AddMsg(rs.ssi()->SSIRes("roulette_user_join"));
		}
	}
	int i = cHistory;
	while( i > 0 )
	{
		i--;
		rs.ssi()->SSIValue("NUMBER",fHistory[i]);
		Player->AddMsg(rs.ssi()->SSIRes("roulette_history"));
	}
	if( Mode() == 0 ) {
		Player->AddMsg(TimerToSSI(rs.ssi()));
		for( unsigned int i = 0; i < fBetList.Count(); i++ )
		{
			TBet *Bet = fBetList.Get(i);
			rs.ssi()->SSIValue("USERID",Bet->Player()->ID());
			rs.ssi()->SSIValue("ID",Bet->Code());
			rs.ssi()->SSIValue("CASH",Bet->Cash());
			Player->AddMsg(rs.ssi()->SSIRes("roulette_bet_user"));
		}
	} else
		ModeClear();
}


void TRouletteRoom::OnPlayerDel(IPlayer *Player)
{
	TServerSSI rs;
	unsigned int i = 0;
	while( i < fBetList.Count() )
	{
		if( fBetList.Get(i)->Player() == Player ) {
			if( Player->User() != NULL )
				Player->User()->CashBetAdd(Table(),-fBetList.Get(i)->Cash());
			fBetList.Del(i);
		} else
			i++;
	}
	rs.ssi()->SSIValue("ID",Player->ID());
	PlayerMessage(rs.ssi()->SSIRes("roulette_user_leave"),Player);
}


void TRouletteRoom::Init()
{
	int i = 0;
/*
	TFile f("game_roulette.ini",false);
	while( i < sCount )
	{
		TStr str(Read(f.stream));
		strncpy(fBetCode[i],str.c_str(),3);
		fBetCode[i][3] = '\0';
		for( int j = 0; j < 37; j++ )
		{
			str = Read(f.stream);
			fBetCashWin[i][j] = str.ToInt();
		}
		i++;
	}
*/
	m_ssi::TSSIControl ssi;
	ssi.SSILoad("server_roulette.ini");
	for( i = 0; i < 3; i++ )
	{
		TXML xml;
		xml.FromStr(ssi.SSIRes("roulette_betlimit_"+TStr(i+1)).c_str());
		for( unsigned int j = 0; j < 8; j++ )
		{
			fBetCashCode[j][i] = xml.GetNode(j)->VarValue("id")[0];
			fBetCashMin[j][i] = xml.GetNode(j)->VarValue("cash-min").ToInt();
			fBetCashMax[j][i] = xml.GetNode(j)->VarValue("cash-max").ToInt();
		}
	}
}

TStr TRouletteRoom::ModeAsStr()
{
	if( Mode() == 0 )
		return "game";
	return "ok";
}

void TRouletteRoom::OnRequest(TRequest *r, IPlayer* Player)
{
	OnBet(r,Player);
	if( !Player->isGame() )
		return;
	if( !isTimerStart() )
		TimerStart();
	TServerSSI rs;
	OnGame();
	if( Mode() == 0 ) {
		r->AddReturn(TimerToSSI(rs.ssi()));
		r->AddStatus("game");
	}
	if( Mode() == 1 ) {
		ModeClear();
		r->AddStatus("ok");
	}
}
